<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>Theory of programming: packaging principles</title>

        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

        <meta name="description" content="Theory of programming: packaging principles">
        <meta name="author" content="Alexander Makarov">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="../../bower_components/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../../css/samdark.css">
        <link rel="stylesheet" href="style.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="../../bower_components/reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>

        <!--[if lt IE 9]>
        <script src="../../bower_components/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <!--
        HOTKEYS:
          - s
          - ESC
          - b
        -->
        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section class="title-slide" data-background="presentation_16_9_back.png">
                    <h1><small>Theory of programming:</small> Packaging principles</h1>

                    <p><a href="https://github.com/samdark">Alexander Makarov</a> / <a href="https://www.yiiframework.com/">Yii core team</a></p>

                    <a href="https://slides.rmcreative.ru/2019/bgphp-packages/">https://slides.rmcreative.ru/2019/bgphp-packages/</a>
                </section>

                <section>
                    <h2>In order to apply a principle <span class="red">correctly</span> you should understand it.</h2>
                </section>

                <section>
                    Let's begin from the very start...
                </section>

                <section>
                    <h3>Abstraction = generalization of essential, removal of non-essential.</h3>
                </section>

                <section>
                    <h2>What for?</h2>
                </section>

                <section>
                    <h2>To fit unfittable</h2>

                    <img src="complicated.jpg" alt="">

                    <p>into...</p>
                </section>

                <section>
                    <img src="brain.png" alt="Source of all trouble" />
                </section>

                <section>
                    <img src="short_memory.svg" alt="Short-term memory" />

                    <p>TTL of the item is ~20 sec.</p>
                </section>

                <section>
                    <p>We can not operate with high number of items:</p>

                    <ul>
                        <li>7±2 items (George Miller, 1989).</li>
                        <li>4±1 (Cowan, 2001).</li>
                        <li>Number depends on items.</li>
                    </ul>
                </section>

                <section>
                    <h2>Trick: chunking</h2>
                </section>

                <section>
                    <h2>88003334434</h2>
                </section>

                <section></section>

                <section>
                    <h2>8-800-333-44-34</h2>
                </section>

                <section></section>

                <section>
                    <p>Architecture is needed to deal with complex systems.</p>
                </section>

                <section>
                    <p>For our brain too complicated comes <span class="red">way too fast</span>.</p>
                </section>

                <section>
                    <h2>Layers!</h2>
                </section>

                <section>
                    <h2>Five entities in a layer. Perfect!</h2>
                </section>

                <section>
                    <h2>More than 5 layers...</h2>
                </section>

                <section>
                    <img src="a_problem.png" />
                </section>

                <section>
                    <img src="lasagna.jpg" />
                </section>

                <section>
                    <h2>Abstraction is a tool, not a goal.</h2>
                </section>

                <section>
                    <h2>Abstraction is necessary <u class="red">evil</u>.</h2>
                </section>

                <section>How to build an abstraction without making everything worse?</section>

                <section>
                    <h2><span class="green">Cohesion</span> / <span class="red">coupling</span></h2>
                </section>

                <section>
                    <h3>Any simple validation rules / markers?</h3>
                </section>

                <section>
                    <h2>SOLID</h2>

                    <p>© 2000 Robert Martin</p>

                    <ul>
                        <li>SRP</li>
                        <li>OCP</li>
                        <li>LSP</li>
                        <li>ISP</li>
                        <li>DIP</li>
                    </ul>
                </section>

                <section>
                    <h3>Not the topic of the talk.</h3>
                </section>

                <section>
                    <h2>What is a "package"?</h2>

                    <img src="package.png" />
                </section>

                <section>
                    <h3>Grouped code items (classes).</h3>
                </section>

                <section>
                    <ul>
                        <li>Modules</li>
                        <li>Libraries</li>
                        <li>Microservices</li>
                    </ul>
                </section>

                <section>
                    <h2>Right questions?</h2>

                    <ul>
                        <li>How to design packages?</li>
                        <li>How to use packages (dependencies)?</li>
                    </ul>
                    
                </section>

                <section>
                    <h3>Does <span class="green">Cohesion</span> / <span class="red">coupling</span> apply to packages?</h3>
                </section>

                <section>
                    <h2>Yes!</h2>
                </section>

                <section>
                    <h3>Can we use same SOLID-markers?</h3>
                </section>

                <section>
                    <h2>Not really...</h2>
                </section>

                <section>
                    <h3><span class="green">Package Cohesion (design)</span></h3>

                    <p>REP, CCP, CRP</p>

                    <h3><span class="red">Package Coupling (usage)</span></h3>

                    <p>ADP, SDP, SAP</p>
                </section>

                <section>
                    <h2><strong class="green">R</strong>euse-Release <strong class="green">E</strong>quivalency <strong class="green">P</strong>rinciple</h2>

                    <blockquote>The granule of reuse is the granule of release</blockquote>

                    <p>Group and prepare code to be reused.<br>Release with proper versioning (SemVer).</p>
                </section>

                <section>
                    <h2><strong class="green">C</strong>ommon <strong class="green">C</strong>losure <strong class="green">P</strong>rinciple</h2>

                    <blockquote>Classes that change together are packaged together</blockquote>

                    <p>The change should be within the package.</p>
                </section>

                <section>
                    <h2><strong class="green">C</strong>ommon <strong class="green">R</strong>euse <strong class="green">P</strong>rinciple</h2>

                    <blockquote>Classes that are used together are packaged together</blockquote>

                    <p>Package should be focused.<br>Client should either use everything or nothing.</p>
                </section>

                <section>
                    <h2>Sounds good?</h2>

                    <img src="pipboy_good.png" />
                </section>

                <section>
                    <h2>Reality is harsh :(</h2>

                    <img src="pipboy_not_good.jpg" />
                </section>

                <section>
                    <img src="triangle_good_fast_cheap.png" />
                </section>

                <section>
                    <img src="principles_triangle.png" alt="" />

                    Dr. Stefan Kluth, Max-Planck-Institut fuer Physik
                </section>

                <section>
                    <p>On early stages focus on <span class="green">CCP</span> and <span class="green">REP</span>.</p>
                </section>

                <section>
                    <img src="principles_triangle.png" alt="" />

                    Dr. Stefan Kluth, Max-Planck-Institut fuer Physik
                </section>

                <section>
                    <h2><strong class="red">A</strong>cyclic <strong class="red">D</strong>ependencies <strong class="red">P</strong>rinciple</h2>

                    <blockquote>The dependency graph of packages must have no cycles</blockquote>

                    <p>Cycles are causing cascading problems.</p>
                </section>

                <section>
                    <h2>How to check for cycles?</h2>
                </section>

                <section>
                    <ul>
                        <li>Draw directed graph.</li>
                        <li>Look at it :)</li>
                    </ul>
                </section>

                <section>
                    <p>There is <a href="https://github.com/clue/graph-composer">clue/graph-composer</a>.</p>
                    <p>But (<a href="https://github.com/clue/graph-composer/pull/45">PR #45</a>) should be applied to exclude non-interesting packages.</p>
                </section>

                <section>
                    <img src="dag.svg">
                </section>

                <section>
                    <p>The less dependencies the simpler everything is...</p>
                </section>

                <section>
                    <h2>How to break the cycle?</h2>

                    <ul>
                        <li>DIP &mdash; use dependency inversion via interface.</li>
                        <li>CRP &mdash; move the interface into separate package.</li>
                    </ul>

                    <p>Or rethink the package...</p>
                </section>

                <section>
                        <h2><strong class="red">S</strong>table <strong class="red">D</strong>ependencies <strong class="red">P</strong>rinciple</h2>

                        <blockquote>Depend in the direction of stability</blockquote>

                        <p>You can't build stable thing on unstable base.</p>
                </section>

                <section>
                    <h3>Can we measure (in)stability?</h3>
                </section>

                <section>
                    <h2>I = <span class="green">C<sub>e</sub></span> / (<span class="green">C<sub>e</sub></span> + <span class="red">C<sub>a</sub></span>)</h2>

                    <ul>
                        <li>I &mdash; Instability. 1 &mdash; unstable, 0 &mdash; stable.</li>
                        <li><span class="green">C<sub>e</sub></span> &mdash; Efferent Coupling. Number of classes that depend on the package.</li>
                        <li><span class="red">C<sub>a</sub></span> &mdash; Afferent Coupling. Number of classes package depends on.</li>
                    </ul>
                </section>

                <section>
                    <h3>How to increase stability?</h3>
                </section>

                <section>
                        <h2><strong class="red">S</strong>table <strong class="red">A</strong>bstractions <strong class="red">P</strong>rinciple</h2>

                        <blockquote>A package abstractness should increase with stability</blockquote>

                        <p>Stable packages are abstract. <br> Flexible packages are concrete.</p>
                </section>

                <section>
                    <h3>Can we measure abstractness?</h3>
                </section>

                <section>
                    <h2>A = <span class="red">N<sub>a</sub></span> / <span class="green">N<sub>c</sub></span> + <span class="red">N<sub>a</sub></span></h2>

                    <ul>
                        <li>A &mdash; abstractness. 0 &mdash; concrete, 1 &mdash; abstract.</li>
                        <li><span class="red">N<sub>a</sub></span> &mdash; number of abstract entities in a package.</li>
                        <li><span class="green">N<sub>c</sub></span> &mdash; number of concrete entities in a package.</li>
                    </ul>
                </section>

                <section>
                    <ul>
                        <li>Abstract packages → stable: safe to depend on them.</li>
                        <li>Concrete packages → unstable: easy to change them.</li>
                    </ul>
                </section>

                <section>
                    <h2>D-metric</h2>

                    <img src="d-metrics.png" alt="">

                    <p>X axis &mdash; abstractness, Y axis &mdash; instability.</p>
                </section>

                <section>
                    <h2>D = | A + I &minus; 1 |</h2>

                    <p>Distance from main line.<br>0 is good.<br>1 is bad.</p>
                </section>

                <section>
                    <h2>Good and bad</h2>
                    
                    <img src="d-metrics-bad.png" alt="">

                    <p>Sometimes 0, 0 is OK. Strings, arrays, stdlib.</p>
                </section>

                <section>
                    <h2>PHP Tools</h2>

                    <ul>
                        <li><a href="https://github.com/pdepend/pdepend">PHP_Depend</a></li>
                        <li><a href="http://www.phpmetrics.org/">PhpMetrics</a></li>
                    </ul>
                </section>

                <section>
                    <p>Same as SOLID, these principles and metrics are not dogmas but tools.</p>
                </section>

                <section>
                    <p>Correct design results in explosive increase in number of packages. It is scary.</p>
                </section>

                <section>
                    <p>Principles are there to keep you away from either left-pad or monolith.</p>
                </section>

                <section>
                    <p>These tools should help producing code that breaks less.</p>
                </section>

                <section>
                    <h2>Questions time!</h2>

                    <ul>
                        <li>sam@rmcreative.ru</li>
                        <li>@sam_dark</li>
                        <li><a href="https://slides.rmcreative.ru/2019/bgphp-packages/">https://slides.rmcreative.ru/2019/bgphp-packages/</a></li>
                        <li><a href="https://en.wikipedia.org/wiki/Short-term_memory">Wikipedia: Short-term memory</a></li>
                        <li><a href="http://wiki.c2.com/?WelcomeVisitors">c2 wiki</a></li>
                        <li><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod ">Principles of OOD</a></li>
                        <li>Agile Software Development, Principles, Patterns, and Practices &mdash; Robert C. Martin</li>
                        <li><a href="https://matthiasnoback.nl/book/principles-of-package-design/">Principles of Package Design &mdash; Matthias Noback</a></li>
                    </ul>
                </section>

            </div>

        </div>

        <script src="../../bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="../../bower_components/reveal.js/js/reveal.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,
                slideNumber: false,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../../bower_components/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../../bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                ]
            });

            Reveal.addEventListener('slidechanged', (event) => {
                const isFirst = event.indexh === 0;
                var slideNumber = false;
                if (!isFirst) {
                    slideNumber = 'c/t';
                }
                Reveal.configure({ slideNumber: slideNumber});
            });

        </script>

    </body>
</html>
