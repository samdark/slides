<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>Yii2: Структура большого проекта</title>

        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

        <meta name="description" content="Yii2: Структура большого проекта. Архитектура, надёжность, поддерживаемость">
        <meta name="author" content="Александр Макаров">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="../../bower_components/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../../css/samdark.css">
        <link rel="stylesheet" href="style.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="../../bower_components/reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>

        <!--[if lt IE 9]>
        <script src="../../bower_components/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <!--
        HOTKEYS:
          - s
          - ESC
          - b
        -->
        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section class="title-slide">
                    <h1>Yii2: Структура большого проекта</h1>

                    <h2>Архитектура, надёжность, поддерживаемость</h2>

                    <p><a href="http://github.com/samdark">Александр Макаров</a></p>
                    <p>
                        <small>
                            <a href="http://www.yiiframework.com/">Yii core team,</a>
                            <a href="http://www.stay.com/">Stay.com</a>
                        </small>
                    </p>

                    <a href="http://slides.rmcreative.ru/2016/yii2-architecture/">http://slides.rmcreative.ru/2016/yii2-architecture/</a>
                </section>

                <section>
                    <h2>Архитектура?</h2>

                    <p><a href="http://www.sei.cmu.edu/architecture/start/glossary/community.cfm">Чёткого определения нет :)</a></p>
                </section>

                <section>
                    <p>Ряд решений о том, как взаимодействуют отдельные части системы. Это, в основном,
                    глобальные решения, которые тяжело изменить потом.</p>
                </section>

                <section>
                    <ul>
                        <li>На какие элементы разбить код?</li>
                        <li>Как эти элементы взаимодействуют?</li>
                    </ul>
                </section>

                <section>
                    <p>Архитектура &mdash; это про интерфейсы и контракты. Не про код и конкретную реализацию.</p>
                </section>

                <section>
                    <h2>Что такое интерфейс?</h2>
                </section>

                <section>
                    <p>Наследование знают все. А что такое инкапсуляция и полиморфизм? Какой их смысл?</p>
                </section>

                <section>
                    <h2>Фреймворк &mdash; не архитектура</h2>

                    <p>Он не построит архитектуру за вас.</p>
                </section>

                <section>
                    <p>Фреймворк <strong>ничего не знает об элементах вашего приложения</strong> и
                        <strong>не может определить интерфейсы для взаимодействия этих элементов</strong>.</p>
                </section>

                <section>
                    <p>Но может дать начальный шаблон и инфраструктуру. В случае Yii это MVC.</p>
                </section>

                <section>
                    <p>basic/advanced &mdash; не догма и не шаблон полноценной архитектуры</p>
                </section>

                <section>
                    <h2>Кстати, про MVC...</h2>
                </section>

                <section>
                    <h2>Controller</h2>

                    <ul>
                        <li>Принимает данные извне (GET, POST, консольный ввод, ...).</li>
                        <li>Отдаёт данные в нужном виде в Model и View.</li>
                        <li><strong>Не реализует логику, не занимается форматированием или формированием ответа.</strong></li>
                    </ul>
                </section>

                <section>
                    <h2>View</h2>

                    <ul>
                        <li>Получает подготовленные контроллером данные.</li>
                        <li>Форматирует данные для ответа.</li>
                        <li><strong>Никогда не работает с внешними данными, базой или пользовательским вводом напрямую.</strong></li>
                    </ul>
                </section>

                <section>
                    <h2>Model</h2>

                    <ul>
                        <li><strong>Не Model в Yii! Не ActiveRecord!</strong></li>
                        <li><strong>M в MVC - не один класс, а целый доменный слой (вся логика приложения).</strong></li>
                        <li>Получает подготовленные контроллером данные, обрабатывает их, возвращает результат.</li>
                        <li><strong>Никогда не работает с внешними данными или пользовательским вводом напрямую.</strong></li>
                        <li><strong>Не занимается форматированием или формированием ответа.</strong></li>
                    </ul>
                </section>

                <section>
                    <h2>Паттерны проектирования &mdash; не архитектура.</h2>
                </section>

                <section>
                    <p>Это проверенные варианты решения более-менее распространённымх проблем. У каждого паттерна есть как плюсы,
                    так и минусы.</p>
                </section>

                <section>
                    <h2>Зачем нужна архитектура?</h2>
                </section>

                <section>
                    <p>Для борьбы со сложностью.</p>

                    <p>Цель &mdash; сделать понятным каждый уровень абстракции.</p>
                </section>

                <section>
                    <ul>
                        <li>Для изменения под реалии бизнеса.</li>
                        <li>Чтобы не приходилось всё переписывать с нуля.</li>
                        <li>Сделать с первого раза правильно не просто.</li>
                    </ul>
                </section>

                <section>
                    <p>Хорошая архитектура &mdash; это дорого. Плохая &mdash; еще дороже.</p>
                </section>

                <section>
                    <p>"If you think good architecture is expensive, try bad architecture"<br>&ndash; Brian Foote and Joseph Yoder</p>
                </section>

                <section>
                    <h2>SOLID</h2>
                </section>

                <section>
                    <h2>Single Responsibility</h2>

                    <p>Класс должен делать что-то одно.</p>
                </section>

                <section>
                    <h2>Open-closed</h2>

                    <p>Класс или модуль (несколько связанных классов) должен скрывать детали реализации (то есть
                        как именно он работает внутри), но иметь чётко определённый интерфейс, который позволяет
                        как использовать модуль или класс (public методы), так и расширять его наследованием (protected
                        и public методы).</p>
                </section>

                <section>
                    <h2>Liskov substitution</h2>

                    <p>Принцип об иерархии и наследовании. Классическое определение очень запутанное. Можно проще.</p>

                    <p>Когда мы реализовываем новый класс, наследуясь от существующего,
                        новый должен быть с тем же интерфейсом и вести себя абсолютно так же в тех же ситуациях. Так,
                        чтобы программа работала, если подсунуть ей как родителя, так и наследника.</p>
                </section>

                <section>
                    <h2>Interface segregation</h2>

                    <p>Интерфейс не должен определять больше функциональности, чем используется за один раз. Это как
                        Single Responsibility, только для интерфейсов. Если интерфейс описывает больше одной задачи,
                        разбиваем его на несколько интерфейсов.</p>
                </section>

                <section>
                    <h2>Dependency inversion</h2>

                    <p>Класс должен объявлять зависимости (то, что ему нужно) через интерфейсы, но никогда не получать их
                    самостоятельно.</p>
                </section>

                <section>
                    <h2>Хорошие и плохие зависимости</h2>

                    <ul>
                        <li>Cohesion - связность.</li>
                        <li>Coupling - связанность.</li>
                    </ul>
                </section>

                <section>
                    <h2>Cohesion</h2>

                    <p>Зависимость классов, которые служат единой цели.</p>
                </section>

                <section>
                    <h2>Coupling</h2>

                    <p>Зависимость классов, цели которых отличаются.</p>
                </section>

                <section>
                    <p>Cohesion - хорошо. Coupling - плохо.</p>
                </section>

                <section>
                    <ul>
                        <li><strong>Служащие одной цели классы</strong> собираются в модули (Не модули Yii! Не конкретные классы! Логические рамки).</li>
                        <li><strong>Внутри модуля</strong> используем его классы напрямую. <strong>Нет смысла абстрагироваться</strong>.</li>
                        <li>Используемые модулем классы, но <strong>не связанные с ним</strong>, используются <strong>только через интерфейсы</strong>.</li>
                        <li>Модулю наплевать на то, как он получит зависимости.</li>
                    </ul>
                </section>


                <section>
                    <h2>Active Record</h2>

                    <ul>
                        <li>Делает одновременно слишком много.</li>
                        <li>Притягивает к себе бизнес-логику (ей не место в моделях AR).</li>
                        <li>Позволяет достичь цели очень быстро.</li>
                        <li>Удобен.</li>
                    </ul>
                </section>

                <section>
                    <h2>Переабстрагирование</h2>

                    <p>Чрезмерное увлечение абстракцией может привести к тому, что каждый отдельный её уровень
                    слишком прост, а взаимодействие уровней слишком сложно.</p>
                </section>

                <section>
                    <h2>Документирование архитектурных решений</h2>
                </section>

                <section>
                    <h2>Что описывать?</h2>

                    <ul>
                        <li>Модули: структура компонентов.</li>
                        <li>Компоненты и коннекторы: взаимодействие компонентов.</li>
                        <li>Размещение: физическое распределение компонентов по серверам.</li>
                    </ul>
                </section>

                <section>
                    <h2>Чем описывать?</h2>

                    <ul>
                        <li>Текст</li>
                        <li>UML</li>
                    </ul>
                </section>

                <section>
                    <h2>Как сделать приложение надёжным?</h2>
                </section>

                <section>
                    <p>Исправляю одно, отваливается другое...</p>
                </section>

                <section>
                    <h2>TDD/BDD</h2>

                    <p>Тестировать.</p>
                </section>

                <section>
                    <p>Ключевые места хорошей архитектуры не сложно тестировать.</p>
                </section>

                <section>
                    <p>Архитектура зависит в большей степени от предметной области, а не от применяемых фреймворков и библиотек.</p>
                </section>

                <section>
                    <h2>DDD</h2>

                    <p>Domain Driven Design</p>
                </section>

                <section>
                    <p>Программист недостаточно знает автоматизируемый им процесс.</p>

                    <p>Есть человек, который знает его от и до. Это доменный эксперт.</p>
                </section>

                <section>
                    <ul>
                        <li>Большие проекты (> 6 месяцев)</li>
                        <li>Цель &mdash; получить архитектуру, близкую к реальному процессу</li>
                        <li>Использовать термины реального процесса</li>
                    </ul>
                </section>


                <section>
                    <h2>Структурные блоки</h2>

                    <ul>
                        <li>Value object &mdash; значение, которое может включать в себя другие значения.</li>
                        <li>Entity &mdash; объекты, которые можно идетифицировать. Взяв два объекта и сравнив их, можно
                        определить, тот же это объект или нет.</li>
                        <li>Aggregate root &mdash; объект, содержащий другие объекты, не имеющие смысла без родителя.</li>
                    </ul>
                </section>

                <section>
                    <p>Доменный слой не зависит ни от чего, только от PHP.</p>
                </section>

                <section>
                    <h2>Главные паттерны</h2>

                    <ul>
                        <li>Инфраструктура: <a href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> &mdash; сохраняет чистые
                            объекты и загружает их. Чаще всего речь идёт про базу данных. Не AR!</li>
                        <li><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Factory</a> &mdash; создаёт объекты.</li>
                        <li>Доменный сервис &mdash; использует entity для какой-то полезной работы. Всё ещё не зависит ни от чего
                        вне домена.</li>
                        <li>Сервис приложения &mdash; предоставлятся фреймворком (components). Может использовать доменный
                        сервис для работы с доменом.</li>
                    </ul>
                </section>
                
                <section>
                    <h2>Почитать</h2>

                    <ul>
                        <li><a href="http://download.microsoft.com/documents/rus/msdn/%D1%80%D1%8B_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9_%D0%BF%D0%BE%D0%BB%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BD%D0%B8%D0%B3%D0%B0.pdf">Руководство Microsoft по проектированию архитектуры приложений</a></li>
                        <li><a href="https://www.infoq.com/minibooks/domain-driven-design-quickly">Domain Driven Design Quickly (InfoQ)</a></li>
                        <li><a href="http://martinfowler.com/eaaCatalog/">Catalog of Patterns of Enterprise Application Architecture</a></li>
                        <li><a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a></li>
                    </ul>
                </section>

                <section>
                    <h2>Время вопросов!</h2>

                    <ul>
                        <li><a href="http://slides.rmcreative.ru/2016/yii2-architecture/">http://slides.rmcreative.ru/2016/yii2-artchitecture/</a></li>
                        <li><a href="http://www.yiiframework.com/">http://www.yiiframework.com/</a></li>
                    </ul>

                    <img src="elephant.png" />
                </section>

            </div>

        </div>

        <script src="../../bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="../../bower_components/reveal.js/js/reveal.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                slideNumber: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../../bower_components/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../../bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                ]
            });

        </script>

    </body>
</html>
